<?xml version="1.0" encoding="utf-8" ?>
<ContentPage  
  x:Class="MarketingAppHJ.Cliente.Views.Aplicacion.CarritoPage.CarritoPage"  
  xmlns="http://schemas.microsoft.com/dotnet/2021/maui"  
  xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"  
  xmlns:vm="clr-namespace:MarketingAppHJ.Cliente.ViewModels.CarritoPageViewModel"  
  BackgroundColor="{DynamicResource Background}"  
  Padding="20">  

  <!-- BindingContext VM -->  
   <ContentPage.BindingContext>  
       <vm:CarritoPageViewModel/>  
   </ContentPage.BindingContext>  

   <Grid RowDefinitions="Auto,*,Auto" RowSpacing="10">  

       <!-- 1) Encabezado -->  
       <Label  
     Grid.Row="0"  
     Text="Tu Carrito"  
     FontSize="24"  
     FontAttributes="Bold"  
     TextColor="{DynamicResource TextPrimaryOnSurface}"  
     HorizontalOptions="Center"  
     Margin="0,0,0,10"/>  

       <!-- 2) Lista de ítems -->  
       <CollectionView  
     x:Name="CarritoCollection"  
     Grid.Row="1"  
     ItemsSource="{Binding Items}"  
     SelectionMode="None"  
     ItemsLayout="VerticalList">  
           <CollectionView.ItemTemplate>  
               <DataTemplate>  
                   <Border Style="{StaticResource ProductCardStyle}">  
                       <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="12" Padding="10">  

                           <!-- Imagen -->  
                           <Image  
               Source="{Binding ImagenUrl}"  
               Aspect="AspectFill"  
               WidthRequest="80"  
               HeightRequest="80"  
               VerticalOptions="Center"/>  

                           <!-- Nombre y precio -->  
                           <VerticalStackLayout  
               Grid.Column="1"  
               Spacing="4"  
               VerticalOptions="Center">  
                               <Label  
                 Text="{Binding Nombre}"  
                 Style="{StaticResource ProductNameStyle}"/>  
                               <Label  
                 Text="{Binding Precio, StringFormat='{}{0:C}'}"  
                 Style="{StaticResource ProductPriceStyle}"/>  
                               <!-- Eliminar -->  
                               <Button  
                 Text="Eliminar"  
                 Command="{Binding BindingContext.RemoveItemCommand, Source={x:Reference CarritoCollection}}"  
                 CommandParameter="{Binding ProductoId}"  
                 BackgroundColor="{DynamicResource Forninary}"  
                 TextColor="{DynamicResource Secondary}"  
                 CornerRadius="10"  
                 Padding="5"  
                 HorizontalOptions="Start"/>  
                           </VerticalStackLayout>  

                           <!-- Total de la línea -->  
                           <Label  
               Grid.Column="2"  
               Text="{Binding Total, StringFormat='{}{0:C}'}"  
               Style="{StaticResource ProductPriceStyle}"  
               VerticalOptions="Center"/>  
                       </Grid>  
                   </Border>  
               </DataTemplate>  
           </CollectionView.ItemTemplate>  
       </CollectionView>  

       <!-- 3) Pie: total general + acciones -->  
       <VerticalStackLayout  
     Grid.Row="2"  
     Spacing="12"  
     BackgroundColor="{DynamicResource Surface}"  
     Padding="16">  

           <BoxView HeightRequest="1" Color="{DynamicResource Tertiary}" />  

           <Grid ColumnDefinitions="Auto,Auto" HorizontalOptions="End">  
               <Label Text="Total:"  
              FontSize="20"  
              FontAttributes="Bold"  
              TextColor="{DynamicResource TextPrimaryOnSurface}"  
              Grid.Column="0"/>  
               <Label  
         Text="{Binding TotalPrice, StringFormat='{}{0:C}'}"  
         FontSize="20"  
         FontAttributes="Bold"  
         TextColor="{DynamicResource PrimaryDark}"  
         Grid.Column="1"/>  
           </Grid>  

           <Grid ColumnDefinitions="*,*" ColumnSpacing="12">  
               <Button  
         Text="Vaciar carrito"  
         Command="{Binding ClearCartCommand}"  
         BackgroundColor="{DynamicResource Tertiary}"  
         TextColor="{DynamicResource TextPrimaryOnSurface}"  
         CornerRadius="25"  
         HeightRequest="50"  
         Grid.Column="0"/>  

               <Button  
         Text="Realizar pedido"  
         Command="{Binding CheckoutCommand}"  
         BackgroundColor="{DynamicResource Primary}"  
         TextColor="{DynamicResource Secondary}"  
         CornerRadius="25"  
         HeightRequest="50"  
         Grid.Column="1"/>  
           </Grid>  

       </VerticalStackLayout>  

   </Grid>  
</ContentPage>
