<?xml version="1.0" encoding="utf-8" ?>
<ContentPage  
   x:Class="MarketingAppHJ.Cliente.Views.Aplicacion.CarritoPage.CarritoPage"  
   xmlns="http://schemas.microsoft.com/dotnet/2021/maui"  
   xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"  
   xmlns:vm="clr-namespace:MarketingAppHJ.Cliente.ViewModels.CarritoPageViewModel"
   BackgroundColor="{DynamicResource Background}"  
   Padding="20">  

   <!-- BindingContext VM -->  
   <ContentPage.BindingContext>  
       <vm:CarritoPageViewModel/>  
   </ContentPage.BindingContext>  

   <Grid RowDefinitions="Auto,*,Auto" RowSpacing="10">  

       <!-- 1. Encabezado -->  
       <Label  
           Grid.Row="0"  
           Text="Tu Carrito"  
           FontSize="24"  
           FontAttributes="Bold"  
           TextColor="{DynamicResource TextPrimaryOnSurface}"  
           HorizontalOptions="Center"  
           Margin="0,0,0,10"/>  

       <!-- 2. Lista de ítems -->  
       <CollectionView  
           x:Name="Collecion"  
           Grid.Row="1"  
           ItemsSource="{Binding Items}"  
           SelectionMode="None"  
           Margin="0"  
           ItemsLayout="VerticalList">  
           <CollectionView.ItemTemplate>  
               <DataTemplate>  
                   <Border Style="{StaticResource ProductCardStyle}">  
                       <Grid ColumnDefinitions="Auto,*,*,Auto" RowDefinitions="Auto" ColumnSpacing="12">  

                           <!-- Imagen -->  
                           <Image  
                               Source="{Binding ImagenUrl}"  
                               Aspect="AspectFit"  
                               WidthRequest="80"  
                               HeightRequest="80"  
                               VerticalOptions="Center"/>  

                           <!-- Detalle y eliminar -->
                            <VerticalStackLayout  
                               Grid.Column="1"  
                               Spacing="4"  
                               VerticalOptions="Center">
                                <Label  
                                   Text="{Binding Nombre}"  
                                   Style="{StaticResource ProductNameStyle}"/>
                                <Label  
                                   Text="{Binding Precio, StringFormat='{}{0:C}'}"  
                                   Style="{StaticResource ProductPriceStyle}"/>

                                <!-- Botón eliminar ítem -->
                                <Button  
                                   Text="Eliminar"  
                                   Clicked="OnRemoveClicked"  
                                   CommandParameter="{Binding ProductoId}"  
                                   BackgroundColor="{DynamicResource Forninary}"  
                                   TextColor="{DynamicResource Secondary}"  
                                   CornerRadius="10"  
                                   Padding="5"  
                                   HorizontalOptions="Start"/>
                            </VerticalStackLayout>

                            <Label Text="{Binding Cantidad, StringFormat='x {0}'}"
                                       Style="{StaticResource ProductCuantStyle}"
                                       Grid.Column="2"
                                       VerticalOptions="Center"/>

                             <Label Text="{Binding Total, StringFormat='{}{0:C}'}"  
                                    Grid.Column="3"
                                    Style="{StaticResource ProductPriceStyle}"  
                                    VerticalOptions="Center"/>                                
                       </Grid>  
                   </Border>  
               </DataTemplate>  
           </CollectionView.ItemTemplate>  
       </CollectionView>  

       <!-- 3. Pie: total general + botones -->  
       <VerticalStackLayout  
           Grid.Row="2"  
           Spacing="12"  
           BackgroundColor="{DynamicResource Secondary}"  
           Padding="16">  

           <!-- Separador -->  
           <BoxView HeightRequest="1" Color="{DynamicResource Tertiary}" />  

           <!-- Total -->  
           <HorizontalStackLayout Spacing="8" HorizontalOptions="End">  
               <Label Text="Total:"  
                   FontSize="20"  
                   FontAttributes="Bold"  
                   TextColor="{DynamicResource TextPrimary}"/>  
               <Label  
                   x:Name="Total"  
                   Text="{Binding TotalPrice, StringFormat='{}{0:C}'}"  
                   FontSize="20"  
                   FontAttributes="Bold"  
                   TextColor="{DynamicResource PrimaryDark}"/>  
           </HorizontalStackLayout>  

           <!-- Botones -->  
           <Grid ColumnDefinitions="*,*" ColumnSpacing="12">  
               <Button  
                   Text="Vaciar carrito"  
                   Clicked="OnClearClicked"  
                   BackgroundColor="{DynamicResource Tertiary}"  
                   TextColor="{DynamicResource TextPrimary}"  
                   CornerRadius="25"  
                   HeightRequest="50"  
                   Grid.Column="0"/>  

               <Button  
                   Text="Realizar pedido"  
                   Clicked="OnCheckoutClicked"  
                   BackgroundColor="{DynamicResource Primary}"  
                   TextColor="{DynamicResource Secondary}"  
                   CornerRadius="25"  
                   HeightRequest="50"  
                   Grid.Column="1"/>  
           </Grid>  

       </VerticalStackLayout>  

   </Grid>  
</ContentPage>
