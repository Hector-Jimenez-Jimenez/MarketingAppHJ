<?xml version="1.0" encoding="utf-8" ?>
<ContentPage  
  x:Class="MarketingAppHJ.Cliente.Views.Aplicacion.CarritoPage.CarritoPage"  
  xmlns="http://schemas.microsoft.com/dotnet/2021/maui"  
  xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"  
  xmlns:vm="clr-namespace:MarketingAppHJ.Cliente.ViewModels.CarritoPageViewModel"  
  BackgroundColor="{DynamicResource Background}"  
  Padding="20">  

  <!-- BindingContext VM -->  
   <ContentPage.BindingContext>  
       <vm:CarritoPageViewModel/>  
   </ContentPage.BindingContext>

    <Grid RowDefinitions="Auto,*,Auto" Padding="20">

        <!-- 1) Encabezado -->
        <Label Text="Tu Carrito"
           Style="{StaticResource TitleLabelStyle}"
           HorizontalOptions="Center" />

        <!-- 2) Lista de ítems -->
        <CollectionView x:Name="Collecion"
                    Grid.Row="1"
                    ItemsSource="{Binding Items}"
                    SelectionMode="None"
                    Margin="0,10"
                    EmptyView="Tu carrito está vacío.">

            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <!-- Cada ítem también dentro de un CardBorderStyle -->
                    <Border Style="{StaticResource CardBorderStyle}">
                        <Grid ColumnDefinitions="*,Auto,Auto" Padding="10" Margin="0,0,0,0">

                            <!-- Imagen -->
                            <Image Source="{Binding ImagenUrl}"
                     Aspect="AspectFit"
                     WidthRequest="80"
                     HeightRequest="80" />

                            <!-- Nombre y precio unitario -->
                            <VerticalStackLayout Grid.Column="1" Spacing="4" Padding="10,0">
                                <Label Text="{Binding Nombre}"
                       Style="{StaticResource SubtitleLabelStyle}" />

                                <Label Text="{Binding Precio, StringFormat='PU: {0:C}'}"
                       Style="{StaticResource BodyLabelStyle}" />

                                <!-- Botón eliminar ítem -->
                                <Button Text="Eliminar"
                        Clicked="OnRemoveClicked"
                        CommandParameter="{Binding ProductoId}"
                        Style="{StaticResource SecondaryButtonStyle}"
                        FontSize="14"
                        Padding="5" />
                            </VerticalStackLayout>

                            <!-- Total de la línea -->
                            <Label Grid.Column="2"
                     Text="{Binding Total, StringFormat='{}{0:C}'}"
                     Style="{StaticResource SubtitleLabelStyle}"
                     VerticalOptions="Center" />
                        </Grid>
                    </Border>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>

        <!-- 3) Pie: total general + vaciar carrito + realizar pedido -->
        <VerticalStackLayout Grid.Row="2" Spacing="12">
            <BoxView HeightRequest="1" Color="{StaticResource BorderColorLight}" />

            <Grid ColumnDefinitions="Auto,Auto" HorizontalOptions="End">
                <Label Grid.Column="0"
               Text="Total:"
               Style="{StaticResource SubtitleLabelStyle}" />

                <Label x:Name="Total"
               Grid.Column="1"
               Text="{Binding TotalPrice, StringFormat='{}{0:C}'}"
               Style="{StaticResource SubtitleLabelStyle}"
               Margin="10,0,0,0" />
            </Grid>

            <Button Text="Vaciar carrito"
              Clicked="OnClearClicked"
              Style="{StaticResource SecondaryButtonStyle}"
              Margin="0,5"/>

            <Button Text="Realizar pedido"
              Clicked="OnCheckoutClicked"
              Style="{StaticResource PrimaryButtonStyle}"
              Margin="0,5"/>
        </VerticalStackLayout>

    </Grid>
</ContentPage>
