<?xml version="1.0" encoding="utf-8" ?>
<ContentPage  
   x:Class="MarketingAppHJ.Cliente.Views.Aplicacion.MainPage.MainPage"  
   xmlns="http://schemas.microsoft.com/dotnet/2021/maui"  
   xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"  
   xmlns:vm="clr-namespace:MarketingAppHJ.Cliente.ViewModels.MainPageViewModel"   
   BackgroundColor="{DynamicResource Background}">  

   <!-- 0) VM -->  
   <ContentPage.BindingContext>  
       <vm:MainPageViewModel />  
   </ContentPage.BindingContext>  

   <!-- 1) Layout principal -->  
   <Grid RowDefinitions="Auto,Auto,*,Auto">  

       <!-- 1.1 Cabecera -->  
       <Grid Grid.Row="0" Style="{StaticResource HeaderStyle}">  
           <Grid.ColumnDefinitions>  
               <ColumnDefinition Width="Auto"/>  
               <ColumnDefinition Width="*"/>  
               <ColumnDefinition Width="Auto"/>  
           </Grid.ColumnDefinitions>  

           <ImageButton  
       Style="{StaticResource IconButtonStyle}"  
       Grid.Column="0"  
       Margin="10"
       Source="iconousuario.png"  
       Aspect="AspectFit"
       Clicked="OnAvatarClicked"/>  

           <ImageButton  
       Style="{StaticResource IconButtonStyle}"  
       Grid.Column="1"  
       HorizontalOptions="Center" 
               Margin="10"
       Source="home.png"  
       Clicked="OnLogoClicked"/>  

           <ImageButton  
       Style="{StaticResource IconButtonStyle}"  
       Grid.Column="2"  
               Margin="10"
       Source="ruedaajustes.png"    
       Clicked="OnSettingsClicked"/>  
       </Grid>  

       <!-- 1.2 Barra de búsqueda -->  
       <Border Grid.Row="1" Style="{StaticResource SearchBorderStyle}">  
           <Grid ColumnDefinitions="Auto,*">
                <Image  
         Source="lupabusqueda.png"  
         WidthRequest="20"  
         HeightRequest="20"  
         Margin="10,0"  
         VerticalOptions="Center"  
         BackgroundColor="{DynamicResource TextSecondaryOnSurface}"/>
         <Entry  
         Grid.Column="1" 
         Placeholder="Busca lo que necesites"  
         Margin="0,0,10,0"  
         BackgroundColor="Transparent"  
         VerticalOptions="Center"  
         TextColor="{DynamicResource TextPrimaryOnSurface}"  
         PlaceholderColor="{DynamicResource TextSecondaryOnSurface}"/>  
           </Grid>  
       </Border>  

       <!-- 1.3 Grid de productos -->  
       <CollectionView  
     Grid.Row="2"  
     x:Name="ProductosCollectionView"  
     ItemsSource="{Binding Productos}"  
     SelectionMode="None"  
     ItemsLayout="VerticalGrid,2"  
     RemainingItemsThreshold="2"  
     RemainingItemsThresholdReached="OnRemainingItemsThresholdReached"  
     Margin="0,0,0,10">  

           <CollectionView.ItemTemplate>  
               <DataTemplate>  
                   <Border Style="{StaticResource ProductCardStyle}">  
                       <Border.GestureRecognizers>  
                           <TapGestureRecognizer  
               Tapped="OnItemTapped"  
               NumberOfTapsRequired="1"/>  
                       </Border.GestureRecognizers>  

                       <VerticalStackLayout Spacing="8">  
                           <Image  
               Source="{Binding ImagenUrl}"  
               Aspect="AspectFit"  
               HeightRequest="120"  
               HorizontalOptions="Center"/>  

                           <Label  
               Text="{Binding Nombre}"  
               Style="{StaticResource ProductNameStyle}"/>  

                           <Label  
               Text="{Binding Descripcion}"  
               Style="{StaticResource ProductDescStyle}"  
               LineBreakMode="TailTruncation"/>  

                           <Label  
               Text="{Binding Precio, StringFormat='Precio: {0:C}'}"  
               Style="{StaticResource ProductPriceStyle}"/>  
                       </VerticalStackLayout>  
                   </Border>  
               </DataTemplate>  
           </CollectionView.ItemTemplate>  
       </CollectionView>  

       <!-- 1.4 Botón del carrito -->  
       <Grid Grid.Row="3"  
         BackgroundColor="{DynamicResource Secondary}"  
         Padding="10"  
         ColumnDefinitions="*,Auto"  
         RowDefinitions="Auto">  
           <BoxView  
       Grid.ColumnSpan="2"  
       HeightRequest="1"  
       Color="{DynamicResource Tertiary}"  
       VerticalOptions="Start"/>  

           <Button  
       Grid.Column="0"  
       Text="Accede a tu carrito"  
       ImageSource="carritocompra.png"  
       ContentLayout="Left,10"  
       BackgroundColor="Transparent"  
       TextColor="{DynamicResource Primary}"  
       CornerRadius="0"  
       VerticalOptions="Center"  
       Clicked="OnCartClicked"/>  
       </Grid>  

   </Grid>  
</ContentPage>
