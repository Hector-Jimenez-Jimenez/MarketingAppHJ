<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:MarketingAppHJ.Cliente.ViewModels.PedidosPageViewModel"
             x:DataType="vm:PedidosPageViewModel"
             x:Class="MarketingAppHJ.Cliente.Views.Aplicacion.PedidosPage.PedidosPage"
             Title="PedidosPage">
    
    
    <Grid RowDefinitions="Auto,*,Auto" Padding="20">

        <!-- 1) Título / Encabezado -->
        <Label
        Text="Mis Pedidos"
        Style="{StaticResource TitleLabelStyle}"
        HorizontalOptions="Center"
        Grid.Row="0" />

        <!-- 2) Lista de pedidos -->
        <CollectionView
        Grid.Row="1"
        ItemsSource="{Binding Pedidos}"
        SelectionMode="None"
        Margin="0,10"
        EmptyView="Todavía no has realizado ningún pedido.">
            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <Border
              Style="{StaticResource CardBorderStyle}"
              Padding="10"
              Margin="0,0,0,15">
                        <VerticalStackLayout Spacing="8">

                            <!-- 2.1 Fila de encabezado del pedido -->
                            <Grid ColumnDefinitions="*,Auto" RowDefinitions="Auto" >
                                <!-- Fecha y Estado -->
                                <VerticalStackLayout Grid.Column="0">
                                    <Label
                      Text="{Binding Pedidos, StringFormat='{0:dd/MM/yyyy HH:mm}'}"
                      Style="{StaticResource SubtitleLabelStyle}" />
                                    <Label
                      Text="{Binding Estado}"
                      Style="{StaticResource SmallLabelStyle}"
                      TextColor="{StaticResource Interactive}"
                      FontAttributes="Bold" />
                                </VerticalStackLayout>

                                <!-- Total del pedido -->
                                <Label
                    Grid.Column="1"
                    Text="{Binding Total, StringFormat='Total: {0:C}'}"
                    Style="{StaticResource SubtitleLabelStyle}"
                    VerticalOptions="Center" />
                            </Grid>

                            <!-- 2.2 Dirección de envío (texto corto) -->
                            <Label
                  Text="{Binding DireccionEnvio}"
                  Style="{StaticResource BodyLabelStyle}"
                  LineBreakMode="TailTruncation" />

                            <!-- 2.3 Lista interna de ítems -->
                            <CollectionView
                  ItemsSource="{Binding Items}"
                  SelectionMode="None"
                  Margin="0,5">
                                <CollectionView.ItemsLayout>
                                    <LinearItemsLayout Orientation="Vertical" ItemSpacing="5" />
                                </CollectionView.ItemsLayout>
                                <CollectionView.ItemTemplate>
                                    <DataTemplate>
                                        <Grid ColumnDefinitions="Auto,*,Auto" Padding="5">
                                            <!-- Imagen -->
                                            <Image
                          Source="{Binding ImagenUrl}"
                          Aspect="AspectFit"
                          WidthRequest="50"
                          HeightRequest="50" />

                                            <!-- Nombre, precio y cantidad -->
                                            <VerticalStackLayout Grid.Column="1" Spacing="2" Padding="8,0">
                                                <Label
                            Text="{Binding Nombre}"
                            Style="{StaticResource BodyLabelStyle}" />
                                                <Label
                            Text="{Binding Cantidad, StringFormat='Cant: {0}'}"
                            Style="{StaticResource SmallLabelStyle}" />
                                            </VerticalStackLayout>

                                            <!-- Subtotal de la línea -->
                                            <Label
                          Grid.Column="2"
                          Text="{Binding Total, StringFormat='{0:C}'}"
                          Style="{StaticResource BodyLabelStyle}"
                          VerticalOptions="Center" />
                                        </Grid>
                                    </DataTemplate>
                                </CollectionView.ItemTemplate>
                            </CollectionView>

                            <!-- 2.4 Botón “Ver detalles” (opcional: navegar a página de detalle de ese pedido) -->
                            <Button
                  Text="Ver detalles"
                  Style="{StaticResource SecondaryButtonStyle}"
                  FontSize="14"
                  CornerRadius="20"
                  HeightRequest="40"
                  CommandParameter="{Binding PedidoId}"
                  Clicked="OnVerDetallesClicked" />
                        </VerticalStackLayout>
                    </Border>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>

        <!-- 3) Botón para refrescar manualmente -->
        <Button
        Grid.Row="2"
        Text="Actualizar"
        Command="{Binding RefreshCommand}"
        Style="{StaticResource PrimaryButtonStyle}"
        CornerRadius="25"
        HeightRequest="45"
        HorizontalOptions="FillAndExpand" />
    </Grid>

</ContentPage>